---
description: 客戶機視頻播放器或清單伺服器可與CRS交互以實現JIT重新打包。 兩者使用相同的廣告選擇邏輯。
title: JIT重組的詳細工作流
source-git-commit: 89bdda1d4bd5c126f19ba75a819942df901183d1
workflow-type: tm+mt
source-wordcount: '524'
ht-degree: 0%

---


# JIT重組的詳細工作流 {#detailed-workflows-for-jit-repackaging}

客戶機視頻播放器或清單伺服器可與CRS交互以實現JIT重新打包。 兩者使用相同的廣告選擇邏輯。

## 清單伺服器啟動的JIT重新打包 {#section_1F1C1B7DD146403890C2B43E24FEF0EB}

![](assets/ssai_JIT-workflow_web.png)

清單伺服器端的JIT重新打包的工作流如下：

1. 清單伺服器向廣告伺服器發出請求。
1. 清單伺服器接收不是HLS格式的廣告創意。
1. 清單伺服器向CDN伺服器發送對廣告創意的先前轉碼的HLS版本的請求。

   >[!NOTE]
   >
   >在多CDN設定中，清單伺服器使用 `ptcdn` 引導URL中的參數以標識CDN伺服器。

1. 清單伺服器檢查響應：

   1. 如果請求成功，清單伺服器將先前轉碼的廣告創意HLS版本插入內容流。
   1. 如果請求失敗，清單伺服器生成日誌條目並從CRS請求轉碼版本。

1. CRS對廣告進行轉碼，並將HLS版本上載到CDN伺服器以備將來使用。

對於該創作內容的所有後續請求，清單伺服器從CDN檢索HLS版本並將其插入內容流。

## 客戶端啟動的JIT重新打包 {#section_FBC97D40043F4FDD98247A08BB6195B0}

<!--<a id="fig_hkn_ndt_3z"></a>-->

![](assets/ssai_JIT-workflow_client_web.png)

基於TVSDK或具有類似功能的客戶端可以與CRS交互以實現JIT重新打包，如下所示：

1. 客戶端從廣告伺服器請求廣告。
1. 廣告伺服器將廣告返回給客戶端。
1. 客戶端檢查廣告伺服器上的廣告的格式：

   1. 如果廣告創意是HLS格式，則客戶端將廣告插入（縫製）內容並完成。
   1. 如果廣告創意不是HLS格式，則客戶端從CDN伺服器請求一個。

      >[!NOTE]
      >
      >在多CDN設定中，清單伺服器使用 `ptcdn` 引導URL中的參數以標識CDN伺服器。

1. 客戶端檢查來自CDN伺服器的響應。

   1. 如果CDN提供了HLS版本，則客戶端將其插入（縫合）內容，並完成。
   1. 如果CDN伺服器未提供HLS版本，則客戶端要求廣告伺服器從CRS請求一個版本。 客戶端不會將廣告插入內容。

1. Ad伺服器請求將非HLS廣告轉碼到HLS。
1. CRS建立HLS版本，並將其上載到CDN伺服器以供將來使用。

## 廣告格式優先順序和時間表 {#section_A74DE37A57BF45D7B6D09E3DE40F8E61}

清單伺服器和客戶機使用相同的選擇邏輯來確定用於播放可用廣告的優先順序。 HLS格式的廣告優先，其次是MP4、FLV和WebM。

CRS通常需要2-4分鐘才能處理非HLS廣告創意，通常不到3分鐘。

CRS產生不同的HLS比特率，因此廣告可以以適合可用連接速度和頻寬的速度播放。 如果存在多個可用比特率，CRS選擇可用的最高比特率。 如果CRS收到非HLS廣告創意，則它會以可用的最高解析度生成HLS版本。