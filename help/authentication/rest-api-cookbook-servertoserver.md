---
title: REST API指南（伺服器到伺服器）
description: 將API烹飪書伺服器放置到伺服器。
exl-id: 36ad4a64-dde8-4a5f-b0fe-64b6c0ddcbee
source-git-commit: bfc3ba55c99daba561255760baf273b6538a3c6e
workflow-type: tm+mt
source-wordcount: '1825'
ht-degree: 0%

---

# REST API指南（伺服器到伺服器） {#rest-api-cookbook-server-to-server}

>[!NOTE]
>
>此頁面上的內容僅供參考。 使用此API需要來自Adobe的當前許可證。 不允許未經授權使用。


## 概述 {#overview}

本指南文檔旨在詳細介紹使用伺服器到伺服器體系結構實施Adobe Primetime身份驗證的最佳做法。  它為生產環境和運營提供了基本要求、分步流程實施和一般考慮。

 

## 元件 {#components}

在工作的「伺服器到伺服器」解決方案中涉及以下元件：

 
|類型 |元件 |描述 | | - | - | - | |流式設備 |流應用 |駐留在用戶流設備上並播放經過驗證的視頻的程式設計師應用程式。 | | | \[可選\] AuthN模組 |如果流設備具有用戶代理（即Web瀏覽器），則AuthN模組負責在MVPD IdP上驗證用戶。 | | \[可選\] AuthN設備 | AuthN應用 |如果流設備沒有用戶代理（即Web瀏覽器），則AuthN應用程式是使用Web瀏覽器從單獨用戶設備訪問的程式設計師Web應用程式。 | |程式設計師基礎架構 |程式設計師服務 |將流設備與Adobe Pass服務連結以獲取身份驗證和授權決定的服務。 | |Adobe基礎架構 |Adobe Pass服務 |與MVPD IdP和AuthZ服務整合併提供身份驗證和授權決定的服務。 | | MVPD基礎架構 | MVPD IdP |提供基於憑據的身份驗證服務以驗證其用戶身份的MVPD終結點。 | | | MVPD AuthZ服務 |根據用戶的訂閱、家長控制等提供授權決定的MVPD終結點。 |


在流程中使用的附加術語定義於
[辭彙表](/help/authentication/glossary.md)。

## 流 {#flows}

### 動態客戶端註冊(DCR)


Adobe Pass使用DCR保護程式設計師應用程式或伺服器與Adobe Pass服務之間的客戶端通信。 DCR流是獨立的、相關的和先決條件的流，可在 [動態客戶端註冊](/help/authentication/dynamic-client-registration.md)。


### 身份驗證(authN)

驗證流用於允許用戶將自己標識到其MVPD以確定用戶是否具有有效帳戶。 

1. 用戶啟動「流式處理設備」應用並嘗試登錄或查看受保護的內容。
2. 流設備應用向程式設計師服務發出請求，以確定設備是否已經過驗證。
3. 程式設計師服務使用DCR註冊應用。
4. 程式設計師服務通過調用Adobe Pass服務來檢查流設備authN狀態 **校驗** API。
5. 對於 **校驗** call返回用戶設備經過身份驗證的狀態，然後應用可以繼續到授權流。
6. 對於 **校驗** call返回「User Device（用戶設備）」未經過身份驗證的狀態，然後應用應等待用戶請求登錄。
7. 當用戶請求直接登錄（例如選擇登錄按鈕）或間接登錄（例如，當未經驗證時選擇受保護內容）時，流設備應用向程式設計師服務發出請求以啟動用戶驗證。 程式設計師服務通過呼叫Adobe Pass服務部請求並接收唯一註冊碼(regcode) **重碼** API。
8. 程式設計師服務還通過調用Adobe Pass服務來檢索當前MVPD和屬性清單 **配置** API。 注：此API也可以在流中較早調用並快取。
9. 程式設計師服務將註冊代碼返回到流式設備應用，並返回步驟\#7中請求的已處理MVPD清單。 注：已處理的MVPD清單格式由程式設計師指定，可以過濾以顯式允許或阻止特定MVPD（即允許或阻止清單）。
10. 如果與AuthN設備不同(即「第二個螢幕」)，根據選擇或必要（即流設備不支援用戶代理），流設備應顯示regcode和URI，供用戶訪問AuthN應用程式。 用戶將URI鍵入AuthN設備上的用戶代理以啟動AuthN應用程式，然後將註冊碼鍵入該應用程式。 如果流設備與AuthN設備相同，則可以通過寫程式方式將重編碼傳遞到AuthN模組。
11. AuthN模組通過顯示MVPD選取器來啟動用戶身份驗證。 用戶選擇MVPD後，AuthN模組將調用 **驗證** 重定向用戶代理到MVPD IdP。 當用戶成功使用MVPD進行驗證時，用戶代理將通過Adobe Pass服務重定向回，在該服務中，成功的驗證將用regcode記錄，然後重定向回AuthN模組。
12. 如果流設備與AuthN設備不同，則AuthN設備應向用戶顯示成功的驗證消息並執行以下步驟：「成功\! 現在，您可以返回到遊戲控制台繼續\[...\]」)。 如果流設備與AuthN設備相同，則流設備可以寫程式檢測驗證完成。

 

下圖說明了驗證流：

![](assets/authn-flow.png)

### 授權(authZ)

授權流用於確定用戶是否有權訪問所請求的內容。

1. 每次用戶嘗試查看流設備應用上的受保護內容時，流設備應用都會調用程式設計師服務來標識內容並請求啟動流所需的權限和資訊。
1. 程式設計師服務公司稱Adobe Pass **授權** 傳遞資源ID的API以及其他必需參數。 Adobe服務使用資源ID調用MVPD AuthZ服務，並接收和授權決定，然後將該決定傳回程式設計師服務。 此授權決定將由Adobe Pass處在可配置的時間段內快取。 後續 **授權** 從程式設計師服務到Adobe Pass服務的呼叫，只要快取值有效，就會返回該值。
1. 如果授權，程式設計師服務部應致電Adobe Pass **/tokens/媒體** API，它將返回簽名的媒體令牌。 程式設計師服務應使用媒體令牌驗證程式庫(JAR)驗證媒體令牌。 如果有效，程式設計師服務應返回在步驟\#1中請求的啟動流（如流URL）的權限和所需權限。
1. 如果拒絕授權， **授權** 調用將向程式設計師服務返回錯誤代碼和說明。 程式設計師服務應在步驟\#1中將錯誤代碼和說明（或程式設計師修改的消息）返回到請求。

下圖說明了授權流：

![](assets/authz-flow.png)

### 註銷

該註銷流允許用戶刪除當前與該應用程式關聯的標識。

1. 當用戶請求註銷（即從設備中刪除與應用程式關聯的當前MVPD帳戶）時，流設備應用會調用程式設計師服務來通知它註銷設備。
1. 程式設計師服務部應致電Adobe Pass **註銷** API。

下圖說明了註銷流：

![](assets/logout-flow.png)

### \[可選\]預授權(即a.飛行前)

可以使用預授權來從一組資源中快速確定用戶可能擁有的資源。  此調用的結果通常用於為單個用戶自定義UI。

1. 一旦用戶被認證，蒸發設備可呼叫程式設計師服務以請求用戶有權流到的內容。

1. 程式設計師服務部應致電Adobe Pass **授權** 包含資源ID清單的API，資源ID是一個簡單字串，通常表示用戶有權流的通道。 *注：當前，* ***授權*** *調用配置為將清單限制為五(5)個資源ID。 當需要5個以上資源時，* ***授權*** *可以進行呼叫，或者可以將呼叫配置為接受來自MVPD的協定的五個以上資源。 實施者應牢記* ***授權*** *調用MVPD資源以及對程式設計師的響應時間，並審慎地構造其調用的使用。*

1. 的 **授權** 調用將使用JSON對象響應程式設計師服務，該JSON對象在請求中為每個資源ID包含TRUE或FALSE值，該請求指示用戶是否有權使用關聯的通道。 *注：如果MVPD未為給定資源ID提供應答（例如，由於網路錯誤或超時），則該值將預設為FALSE。*

1. 程式設計師服務應使用 **授權** 呼叫響應以建立程式設計師定義的對流設備的自定義響應，通常根據用戶的權利對演示進行個性化。

下圖說明了預授權流：

![](assets/preauthz-flow.png)


### \[可選\]元資料

元資料可用於檢索由MVPD共用的用戶資訊。
 此示例可能包括用戶ID、郵遞區號等。

1. 一旦用戶經過身份驗證，程式設計師服務可以呼叫Adobe Pass **用戶元資料** 請求有關已驗證用戶的資訊的API。

1. 響應將包括給定用戶可用的所有元資料。 每個程式設計師/MVPD整合將單獨配置特定欄位。

下圖說明了預授權流：

 

![](assets/user-metadata-api-preauthz.png)

 

## 環境和功能要求{#environments}

 

程式設計師應至少建立兩個環境：一個用於生產，一個或多個用於轉移。


### 生產

生產環境應高度可用並適當擴展，以適應大型或意外的尖峰（例如，現場運動、突發新聞）。

 

Adobe Pass服務在美國各地分散的多個資料中心運行。  達到最佳響應時間(即 最低延遲)，程式設計師還應建立類似的地理位置分散的服務基礎架構。 


程式設計師服務應將DNS快取限制為最大30秒，以防Adobe需要重新路由通信。 如果資料中心變得不可用，則可能會發生這種情況。\
 

程式設計師應提供生產環境的公共IP範圍。 這些IP將輸入到Adobe Pass基礎架構中允許訪問的IP清單中，並由Adobe的公平API使用策略進行管理。

### 暫存

轉移環境可以是最小的，但應包括所有系統元件和業務邏輯。 它應與生產類似，允許測試生產之外的版本。 理想情況下，試運行環境可以連接到Adobe Pass測試環境，供程式設計師使用，並在需要時進行Adobe，以便我們能夠協助測試和故障排除。

### 功能要求

程式設計師服務必須向執行流的設備傳遞準確的設備標識資訊。 此外，程式設計師服務必須將執行流的設備的IP（在x-forwarded-for頭中）與連接源埠（在設備資訊欄位中）一起傳遞：

    **X轉發對象：\&lt;client _ip=&quot;&quot;>** 
    
    位置\&lt;client _ip=&quot;&quot;> 是客戶端公共IP地址
    
     
    
    需要在**regcode**和**authorize**調用上添加頭
    
    示例：
    
    POST/reggie/v1/{req\_id}/regcode HTTP/1.1
    
    X轉發方式：203.45.101.20
    
     
    
    GET/api/v1/授權HTTP/1.1
    
    X轉發方式：203.45.101.20

 

程式設計師服務應發送單個MVPD或整合應用(例如設備IP、源埠、設備資訊、MRSS、可選資料（如ECID）)所需的資料和格式化。 <!--Please see the documentation for [Passing Device and Connection Information Cookbook](http://tve.helpdocsonline.com/passing-device-information-cookbook)-->。


當快取authN或authZ會話時，程式設計師服務必須尊重authN和authZ TTL，並在通知時使authN或authZ會話無效。

程式設計師必須維護與Adobe共用的證書。

<!--
## Related Information {#related}

* [REST API Reference](/help/authentication/rest-api-reference.md)
* [Glossary of Terms](/help/authentication/adobe-pass-glossary.md)
-->
