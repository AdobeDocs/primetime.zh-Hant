---
description: 您可以處理即時視訊串流中的中斷，並在中斷期間提供替代內容。
title: 處理即時資料流中的中斷
exl-id: 2e63fb0c-44b1-46f1-a4b8-f8f67389d183
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '519'
ht-degree: 0%

---

# 處理即時資料流中的中斷{#handle-blackouts-in-live-streams}

您可以處理即時視訊串流中的中斷，並在中斷期間提供替代內容。

當即時資料流中發生中斷時，您的播放器會使用事件處理常式來偵測中斷，並為不符合觀看主要資料流資格的使用者提供替代內容。 您的播放器會偵測中斷期間的開始和結束，將播放從主要資料流切換至替代資料流，並在中斷期間結束時切換回主要資料流。

在您的使用者端應用程式中，您訂閱TVSDK中的中斷標籤。 收到新通知時 *定時中繼資料* 物件時，您可以剖析計時中繼資料物件的資料，以識別該物件是否表示中斷進入或結束。 對於已識別的中斷，您可以呼叫相關的TVSDK元素，以在中斷開始時切換至替代內容，並在中斷結束後再次返回主要內容。

>[!TIP]
>
>在播放內容之前，金鑰仍會從資訊清單下載。

當使用者在中斷期間結束後連線到即時資料流，並及時捲動回中斷期間時，將會播放內容。

>[!IMPORTANT]
>
>如果所有金鑰要求都失敗，則剖析資訊清單時會擲回錯誤。 如果部分請求失敗，部分請求成功，TVSDK會嘗試播放內容。 如果TVSDK嘗試播放內容的某個區段，但沒有可解密此內容的有效金鑰，則會傳回錯誤。

若要處理即時資料流中的中斷：

1. 訂閱即時資料流資訊清單中的中斷標籤，將應用程式設定為偵測中斷標籤。

   TVSDK本身不會偵測中斷標籤；您必須訂閱中斷標籤，才能在資訊清單檔案剖析期間遇到標籤時收到通知。
1. 為您的播放器訂閱的標籤建立事件監聽器。

   當標籤發生時，您的播放器已訂閱前景（主要內容）或背景（替代內容）資料流資訊清單（例如，中斷標籤），TVSDK就會傳送 `TimedMetadataEvent` 並建立 `TimedMetadataObject` 的 `TimedMetadataEvent`.
1. 針對前景和背景資料流的計時中繼資料事件，實作處理常式。

   在這些處理常式中，從定時中繼資料事件物件取得中斷期間的開始和結束時間。
1. 準備 `MediaPlayer` 中斷時。

   當 `MediaPlayer` 進入「已準備」狀態，您計算並準備中斷範圍，並將它們設定在 `MediaPlayer` 物件。

1. 對於播放點位置的每次更新，檢查 `TimedMetadataObjects`.

   這是播放器偵測中斷開始和結束的位置，並追蹤中斷發生的時間。

1. 建立用於在中斷期間開始和結束時切換內容的方法。

   當中斷期間開始時，請將主要內容切換到背景，並將替代內容切換到主要資料流。 繼續擷取並剖析背景中的原始資訊清單，並持續檢查「中斷結束」標籤，讓播放器可以在中斷結束時重新加入原始資料流。
