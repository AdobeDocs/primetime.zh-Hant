---
description: 您可以處理即時視頻流中的封鎖，並在封鎖期間提供備用內容。
title: 處理即時流中的封鎖
exl-id: 2e63fb0c-44b1-46f1-a4b8-f8f67389d183
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '519'
ht-degree: 0%

---

# 處理即時流中的封鎖{#handle-blackouts-in-live-streams}

您可以處理即時視頻流中的封鎖，並在封鎖期間提供備用內容。

當即時流中發生封鎖時，您的播放器使用事件處理程式來檢測封鎖，並為那些不適合觀看主流的用戶提供備用內容。 播放器檢測封鎖期的開始和結束，將回放從主流切換到備用流，並在封鎖期結束時切換回主流。

在客戶端應用中，您在TVSDK中訂閱封鎖標籤。 在收到通知後 *定時元資料* 對象，您可以分析定時元資料對象的資料以確定對象是否指示封鎖條目或退出。 對於已識別的封鎖期，在封鎖期開始時調用相關的TVSDK元素切換到備用內容，並在封鎖期結束時再次返回主內容。

>[!TIP]
>
>在播放內容之前，仍然從清單下載密鑰。

當用戶在封鎖期結束後連接到即時流，並及時滾動到封鎖期時，內容將播放。

>[!IMPORTANT]
>
>如果所有密鑰請求都失敗，則在分析清單時將引發錯誤。 如果某些請求失敗，而某些請求成功，TVSDK會嘗試播放內容。 如果TVSDK嘗試播放內容的某一部分，但沒有有效的密鑰來解密此內容，則返回錯誤。

要處理即時流中的封鎖：

1. 通過訂閱即時流清單中的封鎖標籤，設定應用以檢測封鎖標籤。

   TVSDK本身不檢測封鎖標籤；在清單檔案分析過程中遇到標籤時，必須訂閱封鎖標籤才能接收通知。
1. 為播放器訂閱的標籤建立事件偵聽器。

   當播放器在前景（主內容）或背景（備用內容）流清單中訂閱（例如，封鎖標籤）的標籤出現時，TVSDK將調度 `TimedMetadataEvent` 建立 `TimedMetadataObject` 為 `TimedMetadataEvent`。
1. 為前台和後台流的定時元資料事件實現處理程式。

   在這些處理程式中，從定時元資料事件對象獲取封鎖期的開始和結束時間。
1. 準備 `MediaPlayer` 停電。

   當 `MediaPlayer` 進入PREPARED狀態，計算並準備封鎖範圍，並在 `MediaPlayer` 對象。

1. 對於播放頭位置的每次更新，請檢查 `TimedMetadataObjects`。

   這是您的播放器檢測封鎖期開始和結束的位置，並跟蹤發生封鎖期的時間。

1. 建立用於在封鎖期開始和結束時切換內容的方法。

   當封鎖期開始時，將主內容切換到後台，將備用內容切換為主流。 繼續提取並分析背景中的原始清單，並繼續檢查「封鎖結束」標籤，以便播放器可以在封鎖結束時重新加入原始流。
