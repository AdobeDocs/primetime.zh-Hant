---
description: TVSDK可以偵測即時串流之主要m3u8資訊清單中的已變更播放資訊，並在串流播放時更新播放資訊。 TVSDK可在描述檔出現或消失於主資訊清單時，支援一組動態的位元速率描述檔，包括更新之間不重疊的描述檔位元速率。
title: 即時主要資訊清單更新
exl-id: e3fffe64-1d44-4227-b830-c7661478f067
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '740'
ht-degree: 0%

---

# 即時主要資訊清單更新{#live-master-manifest-update}

TVSDK可以偵測即時串流之主要m3u8資訊清單中的已變更播放資訊，並在串流播放時更新播放資訊。 TVSDK可在描述檔出現或消失於主資訊清單時，支援一組動態的位元速率描述檔，包括更新之間不重疊的描述檔位元速率。

支援下列功能：

* 設定檔計數（增加或減少）
* 設定檔位元速率（重疊或不重疊）
* 具有相同（或不同）伺服器URL的設定檔
* 任何容錯移轉結構

必須符合下列所有條件：

* 串流已上線。
* 時間和etag都會變更。
* 所有轉譯資訊都會維持不變（但URL可能會有所不同）。
* DRM存取資訊保持不變。
* 區段會封裝在相同的PTS和框架邊界周圍，誤差範圍較小。

## 即時主要資訊清單更新架構 {#section_32254A0F684B4960ACC33BF6B1AEF6F1}

以下是TVSDK如何容納更新版主資訊清單的部分資訊和範例。

此功能預設為關閉。 如果您的應用程式透過設定更新頻率（分鐘）將其開啟，則會在每個更新間隔後執行下列步驟：

1. TVSDK會檢查主要資訊清單的上次修改時間和etag，判斷檔案是否已更新。

   如果時間和etag皆已變更，則會將檔案視為已修改。
1. TVSDK會剖析和分析新的資訊清單，並根據更新的性質採取適當的動作。
1. 如果目前的播放位元速率符合修改資訊清單的位元速率，TVSDK會切換至新的設定檔。

   新的設定檔可能來自不同的伺服器或相同的伺服器，位元速率相同。 在此情況下，轉換是平滑的。
1. 如果新資訊清單中不再存在目前的播放位元速率，TVSDK會嘗試在目前設定檔中尋找位元速率，該位元速率也會存在於新資訊清單中。

   * 如果找到相符專案，播放器會先切換至現有資訊清單中的相符位元速率設定檔，再切換至更新資訊清單中的相符位元速率設定檔。 這可確保過渡平滑。
   * 如果先前資訊清單與新資訊清單之間沒有共同的位元速率，或如果TVSDK無法切換到符合的位元速率，TVSDK會直接切換到新資訊清單的最低位元速率設定檔，並使用ABR根據頻寬切換到任何允許的位元速率。 這可能會造成播放稍微有些問題，但影響應該很小。

1. 如果更新成功，TVSDK會傳送 `MediaPlayerItemEvent.MASTER_UPDATED` 事件。
1. 如果更新未成功，則播放會從此更新之前繼續設定。

### 範例1 {#example_DB55F2B9D98741628C9B973E47A0B6A0}

下列位元速率正在即時廣播：

* 500k
* 900k
* 2100k

2100k串流有一些問題，因此需要重新啟動。 主要資訊清單已更新，僅包含500k和900k。 之後不久，在210萬觀看此節目的使用者將會體驗位元速率切換到90萬。 觀看90萬個節目的使用者會繼續觀看90萬個節目。 之後，2100k資料流恢復，並新增回主要資訊清單中。 一段時間後，在900k觀看並擁有頻寬的使用者切換至2100k。

### 範例2 {#example_485E9A9F373D454CADE5395DEC734E5D}

下列位元速率正在即時廣播：

* 500k
* 900k
* 2100k

所有這些位元速率都需要重新啟動。 為此設定了兩個暫時資料流：400k和1500k。 使用者會切換至400k，這是新設定的最低位元速率。 當頻寬足夠時，部分使用者會切換至1500k。 稍後會備份3位元速率，並更新主要資訊清單。 使用者會在500k自動切換回觀看，這是修訂（原始）資訊清單中最低的頻寬。 一段時間後，使用者會切換至其網路所允許的最高頻寬（900k或1200k）。

## 使用即時主要資訊清單更新 {#section_34AC4A9751DB4B7C8561302C6A59A1C4}

您可以開啟此功能並檢查相關事件。

1. 若要開啟即時主要資訊清單更新，請透過設定 `NetworkConfiguration.masterUpdateInterval` 屬性。
1. 或者，您可以偵聽 `MediaPlayerItemEvent.MASTER_UPDATED` 事件。
