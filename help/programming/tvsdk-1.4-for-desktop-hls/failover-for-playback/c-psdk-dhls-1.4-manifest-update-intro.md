---
description: TVSDK能夠檢測主m3u8清單中用於即時流的更改的回放資訊，並在流播放時更新回放資訊。 TVSDK支援動態的比特率配置檔案集，因為配置檔案在主清單中出現或消失，包括更新之間不重疊的配置檔案比特率。
title: 即時主清單更新
exl-id: e3fffe64-1d44-4227-b830-c7661478f067
source-git-commit: be43bbbd1051886c8979ff590a3197b2a7249b6a
workflow-type: tm+mt
source-wordcount: '740'
ht-degree: 0%

---

# 即時主清單更新{#live-master-manifest-update}

TVSDK能夠檢測主m3u8清單中用於即時流的更改的回放資訊，並在流播放時更新回放資訊。 TVSDK支援動態的比特率配置檔案集，因為配置檔案在主清單中出現或消失，包括更新之間不重疊的配置檔案比特率。

支援以下功能：

* 配置檔案計數（增加或減少）
* 配置檔案比特率（重疊或不重疊）
* 具有相同（或不同）伺服器上URL的配置檔案
* 任何故障轉移結構

必須滿足以下所有條件：

* 流是活的。
* 時間和etag都會改變。
* 所有格式副本資訊都保持不變（URL可能不同除外）。
* DRM訪問資訊保持不變。
* 在較小的誤差範圍內，段圍繞相同的PTS和幀邊界封裝。

## 即時主清單更新體系結構 {#section_32254A0F684B4960ACC33BF6B1AEF6F1}

以下是一些有關TVSDK如何容納更新的主清單的資訊和示例。

預設情況下，此功能被關閉。 如果應用程式通過設定更新頻率（以分鐘為單位）來開啟它，則在每次更新間隔後都會執行以下步驟：

1. TVSDK檢查主清單的上次修改時間和標籤以確定檔案是否已更新。

   如果時間和etag都發生了更改，則檔案被視為已修改。
1. TVSDK解析並分析新清單，並基於更新的性質採取適當的操作。
1. 如果當前播放比特率與修改的清單的比特率匹配，則TVSDK切換到新配置檔案。

   新配置檔案可以來自不同的伺服器或同一伺服器，其比特率相同。 在這種情況下，過渡是平穩的。
1. 如果新清單中不再存在當前播放比特率，TVSDK將嘗試在新清單中查找當前配置檔案中也存在的比特率。

   * 如果找到匹配，則播放器首先切換到現有清單中的匹配比特率配置檔案，並切換到更新清單中的匹配比特率配置檔案。 這可確保過渡平穩。
   * 如果先前清單和新清單之間沒有共同的比特率，或者如果TVSDK無法切換到匹配的比特率，則TVSDK直接切換到新清單的最低比特率配置檔案，並使用ABR根據頻寬切換到任何允許的比特率。 這可能會導致回放出現小故障，但影響應該最小。

1. 如果更新成功，TVSDK將派單 `MediaPlayerItemEvent.MASTER_UPDATED` 的子菜單。
1. 如果更新不成功，則播放將繼續進行此更新之前的設定。

### 示例1 {#example_DB55F2B9D98741628C9B973E47A0B6A0}

以下比特率正在即時廣播：

* 500k
* 900k
* 2100k

2100k流存在一些問題，因此需要重新啟動。 主清單更新為僅包含500k和900k。 稍後，在2100k觀看此程式的用戶將經歷一個比特率切換到900k。 90萬觀看者繼續90萬觀看。 之後，2100k流恢復，並將其添加回主清單中。 稍後，900k觀看並擁有頻寬的用戶將切換到2100k。

### 示例2 {#example_485E9A9F373D454CADE5395DEC734E5D}

以下比特率正在即時廣播：

* 500k
* 900k
* 2100k

所有這些比特率都需要重新啟動。 在400k和1500k上為此設定了兩個時間流。 用戶被切換到400k，這是新配置的最低比特率。 有些用戶在頻寬足夠時切換到1500k。 之後，備份三個比特率並更新主清單。 用戶在500k時自動切換回觀看，這是修訂（原始）清單中最低的頻寬。 稍後，用戶將切換到其網路允許的最高頻寬（900k或1200k）。

## 使用即時主清單更新 {#section_34AC4A9751DB4B7C8561302C6A59A1C4}

您可以開啟此功能並檢查相關事件。

1. 要啟用即時主清單更新，請通過設定 `NetworkConfiguration.masterUpdateInterval` 屬性。
1. （可選）通過偵聽 `MediaPlayerItemEvent.MASTER_UPDATED` 的子菜單。
