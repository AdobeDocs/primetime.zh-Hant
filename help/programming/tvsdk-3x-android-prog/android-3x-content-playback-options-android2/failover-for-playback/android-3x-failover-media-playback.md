---
description: 對於即時和隨選影片(VOD)媒體，TVSDK會透過下載與中階解析度位元速率關聯的播放清單來開始播放，並下載該播放清單定義的媒體區段。 它會快速選取高解析度位元速率播放清單及其相關媒體，並繼續下載程式。
title: 媒體播放和容錯移轉
source-git-commit: 02ebc3548a254b2a6554f1ab34afbb3ea5f09bb8
workflow-type: tm+mt
source-wordcount: '596'
ht-degree: 0%

---

# 媒體播放和容錯移轉 {#media-playback-and-failover}

對於即時和隨選影片(VOD)媒體，TVSDK會透過下載與中階解析度位元速率關聯的播放清單來開始播放，並下載該播放清單定義的媒體區段。 它會快速選取高解析度位元速率播放清單及其相關媒體，並繼續下載程式。

## 缺少播放清單容錯移轉 {#section_4EA0AEFA7FB84FCEA699DFB10B135368}

當整個播放清單遺失時，例如當頂層資訊清單檔案中指定的M3U8檔案未下載時，TVSDK會嘗試復原。 如果無法復原，您的應用程式會決定下一個步驟。

如果缺少與中等解析度位元速率關聯的播放清單，TVSDK會搜尋具有相同解析度的變體播放清單。 如果找到相同的解析度，TVSDK會開始從相符位置下載變體播放清單和區段。 如果播放器找不到相同解析度的播放清單，則會嘗試循環播放其他位元速率播放清單及其變體。 立即較低的位元速率是第一個選擇，然後是它的變體，依此類推。 如果嘗試尋找有效播放清單時，所有較低位元速率的播放清單及其變體都已耗盡，TVSDK將會移至最高位元速率，並從此處開始計數。 如果找不到有效的播放清單，程式會失敗，播放器會變成ERROR狀態。

您的應用程式會決定如何處理這種情況。 例如，您可以關閉播放器活動，並將使用者導向目錄活動。 感興趣的事件是 `STATUS_CHANGED` 事件，而對應的回呼為 `onStatusChanged` 方法。 以下程式碼會監控播放器是否將其內部狀態變更為 `ERROR`：

```java
... 
case ERROR: 
getActivity().finish(); // this is where we close the current activity (the Player activity) 
break; 
...
```

## 缺少區段容錯移轉 {#section_D8DF377CCB644D7FB936796DA0CC5A4B}

當區段遺失時，例如當特定區段無法下載時，TVSDK會嘗試透過各種容錯移轉嘗試來復原。 如果無法復原，則會發出錯誤。

如果伺服器上缺少區段，例如因為資訊清單檔案不存在、無法下載區段等等，TVSDK會嘗試透過以下選項進行容錯移轉：

1. 嘗試在變體檔案中以相同的位元速率容錯移轉至相同的區段。
1. 切換至相同檔案中的替代位元速率（ABR切換）。
1. 在每個可用變體中，循環每個可用的位元速率。
1. 略過區段並發出警告。

當TVSDK無法取得替代區段時，就會觸發 `CONTENT_ERROR` 錯誤通知。 此通知包含具有下列專案的內部通知： `DOWNLOAD_ERROR` 程式碼。 如果問題的串流是替代音軌，TVSDK會產生 `AUDIO_TRACK_ERROR` 錯誤通知。

如果視訊引擎持續無法取得區段，則會將持續區段略過限製為5，之後會停止播放且TVSDK會發出 `NATIVE_ERROR` 使用程式碼5。

>[!NOTE]
>
>**限制**
>
>以下是您應留意的一些限制：
>
>* 發生容錯移轉時，不會考慮最適化位元速率(ABR)控制引數。
>
>  這是因為容錯移轉機制的設計是要使用任何目前可用的播放清單（不論其位元速率設定檔為何）作為備份串流。
>* 在容錯移轉作業期間，可以有設定檔切換器。
>
>  如果在下載其中一個播放清單區段期間發生錯誤，則會忽略ABR控制引數，例如最小允許位元速率/最大允許位元速率。
